<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="ThinkPower BPE 電池監控系統 - 高效能物聯網控制面板">
  <title>ThinkPower BPE 電池監控系統</title>
  <link rel="stylesheet" href="/css/main.css">
  <!-- 預加載關鍵資源以優化性能 -->
  <link rel="preload" href="/js/main.js" as="script">
  <link rel="preload" href="/image/thinkpower.ico" as="image">
  <!-- 為樹莓派優化的性能提示 -->
  <meta name="theme-color" content="#000000">
  <meta name="format-detection" content="telephone=no">
</head>
<body>
  <div class="app-container">
    <!-- Logo section -->
    <div class="logo-section">
      <img src="image/thinkpower.ico" 
           alt="新科電力科技 ThinkPower Logo" 
           class="logo-image" 
           loading="eager"
           decoding="sync" />
    </div>
    
    <!-- Navigation tabs - 優化事件委派 -->
    <nav class="navigation-tabs" role="tablist">
      <button class="nav-tab active" 
              data-page="main" 
              role="tab" 
              aria-selected="true"
              aria-controls="mainPage"
              tabindex="0">
        <span>Main</span>
      </button>
      <button class="nav-tab" 
              data-page="settings" 
              role="tab" 
              aria-selected="false"
              aria-controls="settingsPage"
              tabindex="-1">
        <span>Setting</span>
      </button>
      <button class="nav-tab" 
              data-page="help" 
              role="tab" 
              aria-selected="false"
              aria-controls="helpPage"
              tabindex="-1">
        <span>Help</span>
      </button>
    </nav>
    
    <!-- Main content area -->
    <main class="main-content">
      <!-- Main dashboard view -->
      <section class="page-content main-page" 
               id="mainPage" 
               role="tabpanel" 
               aria-labelledby="main-tab">
        <!-- Channel grid container - 使用事件委派優化點擊處理 -->
        <div class="channels-container">
          <div class="channels-grid" 
               id="channelsGrid"
               role="grid"
               aria-label="電池通道狀態格線">
            <!-- Channels will be dynamically generated by JavaScript -->
            <!-- 使用批量DOM更新以優化樹莓派性能 -->
          </div>
        </div>
        
        <!-- Bottom summary panel - 優化數據顯示 -->
        <div class="summary-panel" role="region" aria-label="系統摘要資訊">
          <div class="voltage-summary">
            <div class="voltage-info">
              <div class="voltage-row">
                <span class="voltage-label">Vmax</span>
                <span class="voltage-separator">:</span>
                <span class="voltage-channel" id="vmaxChannel">CH01</span>
                <span class="voltage-equals">=</span>
                <span class="voltage-value" id="vmaxValue" aria-live="polite">3.789 V</span>
              </div>
              <div class="voltage-row">
                <span class="voltage-label">Vmin</span>
                <span class="voltage-separator">:</span>
                <span class="voltage-channel" id="vminChannel">CH24</span>
                <span class="voltage-equals">=</span>
                <span class="voltage-value" id="vminValue" aria-live="polite">3.759 V</span>
              </div>
            </div>
          </div>
          
          <div class="system-summary">
            <div class="summary-info">
              <div class="summary-row">
                <span class="summary-label">總電壓</span>
                <span class="summary-equals">=</span>
                <span class="summary-value" id="totalVoltage" aria-live="polite">59.85</span>
                <span class="summary-unit">V</span>
              </div>
              <div class="summary-row">
                <span class="summary-label">完成數量</span>
                <span class="summary-separator">:</span>
                <span class="summary-value" id="completedCount" aria-live="polite">2</span>
                <span class="summary-unit">個</span>
              </div>
            </div>
          </div>
        </div>
      </section>
      
      <!-- Settings page -->
      <section class="page-content settings-page hidden" 
               id="settingsPage"
               role="tabpanel"
               aria-labelledby="settings-tab">
        <div class="settings-container">
          <form class="settings-form" novalidate>
            <!-- Mode selection -->
            <fieldset class="mode-selection">
              <legend>操作模式選擇</legend>
              <div class="radio-group" role="radiogroup">
                <label class="radio-item">
                  <input type="radio" 
                         name="mode" 
                         value="tracking" 
                         checked 
                         aria-describedby="tracking-desc">
                  <span class="radio-custom" aria-hidden="true"></span>
                  <span class="radio-label">高點追蹤模式</span>
                  <span id="tracking-desc" class="sr-only">自動追蹤電池最高電壓點</span>
                </label>
                <label class="radio-item">
                  <input type="radio" 
                         name="mode" 
                         value="custom" 
                         aria-describedby="custom-desc">
                  <span class="radio-custom" aria-hidden="true"></span>
                  <span class="radio-label">自訂模式</span>
                  <span id="custom-desc" class="sr-only">手動設定電池參數</span>
                </label>
              </div>
            </fieldset>
            
            <!-- Settings inputs - 左欄 -->
            <div class="settings-inputs">
              <div class="input-group">
                <label class="input-label" for="series-count">設定串數</label>
                <input type="number" 
                       id="series-count" 
                       name="seriesCount"
                       class="input-field" 
                       placeholder="請輸入串數" 
                       min="1" 
                       max="48"
                       value="24">
              </div>
              
              <div class="input-group">
                <label class="input-label" for="voltage-set">V set</label>
                <input type="number" 
                       id="voltage-set" 
                       name="voltageSet"
                       class="input-field" 
                       placeholder="請輸入電壓設定" 
                       step="0.001" 
                       min="0" 
                       max="5"
                       value="3.800">
              </div>
              
              <div class="input-group">
                <label class="input-label" for="current-set">I set</label>
                <input type="number" 
                       id="current-set" 
                       name="currentSet"
                       class="input-field" 
                       placeholder="請輸入電流設定" 
                       step="0.001" 
                       min="0" 
                       max="3"
                       value="0.050">
              </div>
              
              <div class="input-group">
                <label class="input-label" for="ec-set">EC set</label>
                <input type="number" 
                       id="ec-set" 
                       name="ecSet"
                       class="input-field" 
                       placeholder="請輸入EC設定" 
                       step="0.001" 
                       min="0" 
                       max="3"
                       value="0.050">
              </div>
            </div>
            
            <!-- Protection settings - 右欄 -->
            <div class="protection-settings">
              <div class="input-group">
                <label class="input-label" for="cell-ov">Cell OV</label>
                <input type="number" 
                       id="cell-ov" 
                       name="cellOV"
                       class="input-field" 
                       placeholder="過壓保護" 
                       step="0.001" 
                       min="3" 
                       max="5"
                       value="4.200">
              </div>
              
              <div class="input-group">
                <label class="input-label" for="cell-uv">Cell UV</label>
                <input type="number" 
                       id="cell-uv" 
                       name="cellUV"
                       class="input-field" 
                       placeholder="欠壓保護" 
                       step="0.001" 
                       min="2" 
                       max="4"
                       value="2.500">
              </div>
              
              <div class="input-group">
                <label class="input-label" for="cell-oc">Cell OC</label>
                <input type="number" 
                       id="cell-oc" 
                       name="cellOC"
                       class="input-field" 
                       placeholder="過流保護" 
                       step="0.001" 
                       min="0.5" 
                       max="5"
                       value="2.000">
              </div>
            </div>
          </form>
        </div>
      </section>
      
      <!-- Help page -->
      <section class="page-content help-page hidden" 
               id="helpPage"
               role="tabpanel"
               aria-labelledby="help-tab">
        <div class="help-container">
          <div class="company-info">
            <img src="/image/company-info.png" 
                 alt="新科電力科技股份有限公司企業資訊" 
                 class="company-image"
                 loading="lazy"
                 decoding="async" />
          </div>
          <div class="license-section">
            <button class="license-button" type="button" aria-label="查看軟體授權條款">
              LICENSE
            </button>
          </div>
        </div>
      </section>
    </main>
    
    <!-- Right info panel -->
    <aside class="info-panel" role="complementary" aria-label="系統資訊面板">
      <!-- Status indicator -->
      <div class="status-card" role="status" aria-live="polite">
        <div class="status-text">
          <span id="systemStatus">待機</span>
        </div>
      </div>
      
      <!-- Process buttons for settings page -->
      <div class="process-buttons hidden" id="processButtons" role="group" aria-label="製程控制按鈕">
        <button class="process-button" type="button" data-process="1">製程1</button>
        <button class="process-button" type="button" data-process="2">製程2</button>
        <button class="process-button" type="button" data-process="3">製程3</button>
        <button class="process-button" type="button" data-process="4">製程4</button>
        <button class="process-button" type="button" data-process="advanced">進階設定</button>
        <button class="process-button save-button" type="button" data-action="save">儲存</button>
      </div>
      
      <!-- Channel detail info -->
      <div class="channel-info" id="channelInfo" role="region" aria-label="選擇通道詳細資訊">
        <div class="channel-title">
          <span id="selectedChannel">Channel 01</span>
        </div>
        <div class="channel-details">
          <div class="detail-row">
            <span class="detail-label">V</span>
            <span class="detail-separator">:</span>
            <span class="detail-value" id="channelVoltage" aria-live="polite">4.000</span>
            <span class="detail-unit">V</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">I</span>
            <span class="detail-separator">:</span>
            <span class="detail-value" id="channelCurrent" aria-live="polite">0.500</span>
            <span class="detail-unit">A</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">P</span>
            <span class="detail-separator">:</span>
            <span class="detail-value" id="channelPower" aria-live="polite">2.000</span>
            <span class="detail-unit">W</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Ah</span>
            <span class="detail-separator">:</span>
            <span class="detail-value" id="channelAh" aria-live="polite">2.55</span>
            <span class="detail-unit">Ah</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Time</span>
            <span class="detail-separator">:</span>
            <span class="detail-value" id="channelTime" aria-live="polite">00:00:00</span>
            <span class="detail-unit"></span>
          </div>
        </div>
      </div>
      
      <!-- Settings info -->
      <div class="settings-info" id="settingsInfo" role="region" aria-label="當前設定資訊">
        <div class="setting-detail">
          <div class="detail-row">
            <span class="detail-label">V set</span>
            <span class="detail-separator">:</span>
            <span class="detail-value" id="voltageSet" aria-live="polite">3.800</span>
            <span class="detail-unit">V</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">EC</span>
            <span class="detail-separator">:</span>
            <span class="detail-value" id="currentSet" aria-live="polite">0.050</span>
            <span class="detail-unit">A</span>
          </div>
        </div>
      </div>
      
      <!-- Control panel - 移除內聯事件處理器以遵循前端規則 -->
      <div class="control-panel" id="controlPanel" role="group" aria-label="系統控制面板">
        <button class="control-button start-button" 
                type="button" 
                data-action="start"
                aria-label="啟動電池監控系統">
          <span>啟　動</span>
        </button>
        <button class="control-button stop-button" 
                type="button" 
                data-action="stop"
                aria-label="停止電池監控系統">
          <span>停　止</span>
        </button>
        <button class="control-button report-button" 
                type="button" 
                data-action="report"
                aria-label="產生系統報告">
          <span>Report</span>
        </button>
      </div>
    </aside>
  </div>
  
  <!-- 延遲載入JavaScript以優化初始頁面載入 -->
  <script type="module" src="/js/main.js" defer></script>
  
  <!-- 為樹莓派性能優化：預連接WebSocket -->
  <script>
    // 預先建立WebSocket連接以減少延遲
    if ('WebSocket' in window) {
      document.addEventListener('DOMContentLoaded', () => {
        // 延遲初始化以避免阻塞主線程
        if (window.requestIdleCallback) {
          requestIdleCallback(() => {
            console.log('BPE系統準備就緒');
          });
        }
      });
    }
  </script>
</body>
</html>
